## [2024-07-26] - Рефакторинг и исправление поиска eBay

### Добавлено
- **Выбор типа поиска:** Реализована возможность для пользователей выбирать тип поиска: `ACTIVE` (активные), `SOLD` (проданные) и `ENDED` (завершенные).
- **Тесты для API:** Добавлен набор модульных тестов для `ebayApi.ts` с использованием Jest для проверки корректности вызовов различных методов API.

### Изменено
- **Разделение логики API:** Логика взаимодействия с eBay API в `ebayApi.ts` была разделена:
    - `Browse API` (`buy.browse.search`) теперь используется только для поиска `ACTIVE` товаров.
    - `Finding API` (`finding.findCompletedItems`) используется для поиска `SOLD` и `ENDED` товаров.
- **Механизм аутентификации:** Полностью переработан механизм аутентификации для соответствия требованиям каждого API:
    - Для `Browse API` используется получение токена OAuth 2.0.
    - Для `Finding API` используется только `appId` (Client ID), передаваемый вручную в параметрах запроса, что решает все предыдущие ошибки `invalid_client` и `RateLimiter`.
- **Обработка запросов:** Множественные запросы теперь выполняются последовательно с задержкой в 1 секунду для соблюдения строгих лимитов `Finding API`.
- **Унификация данных:** Создана единая функция-маппер `mapToEbayItem` для приведения ответов от обоих API к стандартизированной структуре, что обеспечивает стабильность последующей обработки данных.

### Исправлено
- **Надежность кода:** Устранены многочисленные ошибки компиляции TypeScript, опечатки и потенциальные ошибки времени выполнения (например, вызов `.toString()` на `undefined`).
- **Стабильность бота:** Улучшена обработка ошибок в `bot.ts` для предотвращения падений приложения.
## [2024-07-30] - Проверка TOKEN_EXPIRATION_BUFFER
### Изменено
- Начата проверка значения `TOKEN_EXPIRATION_BUFFER` для дальнейшей оптимизации.

## [2024-07-30] - Завершение проверки TOKEN_EXPIRATION_BUFFER
### Изменено
- Завершена проверка значения `TOKEN_EXPIRATION_BUFFER`. Установлено, что текущее значение (5 минут) является оптимальным и не является причиной замедления.

## [2024-07-30] - Добавление логирования времени ответа eBay API
### Добавлено
- Добавлено логирование времени выполнения запросов к eBay Browse API и eBay Finding API для анализа производительности.

## [2024-07-30] - Внедрение Promise.all для параллельной обработки partNumbers
### Изменено
- Изменена функция `searchItemsByKeyword` для приема массива ключевых слов и использования `Promise.all` для параллельного выполнения запросов к eBay API.

## [2024-07-30] - Исправление ошибок компиляции после внедрения Promise.all
### Исправлено
- Исправлены ошибки компиляции в `src/ebay.ts`, связанные с изменением сигнатуры и возвращаемого типа функции `searchItemsByKeyword`.

## [2024-07-30] - Реструктуризация функции findItem для параллельной обработки
### Изменено
- Изменена сигнатура функции `findItem` в `src/ebay.ts` для приема массива `partNumbers` и возврата массива результатов, что позволяет использовать `Promise.all` в `searchItemsByKeyword` для параллельного выполнения запросов.
- Обновлена внутренняя логика `findItem` для обработки результатов от `searchItemsByKeyword` для каждого `partNumber`.

## [2024-07-30] - Исправление ошибок компиляции в src/bot.ts
### Исправлено
- Исправлены ошибки компиляции в `src/bot.ts`, связанные с изменением сигнатуры и возвращаемого типа функции `findItem`.

## [2024-07-30] - Завершение анализа производительности
### Исправлено
- Выявлена и устранена основная причина медленной работы: последовательное выполнение запросов с искусственной задержкой `delay(1000)` в `src/bot.ts`. Удаление задержки и внедрение параллельной обработки запросов через `Promise.all` значительно улучшили производительность.

## [2024-07-30] - Аудит и улучшение обработки ошибок в src/ebayApi.ts
### Изменено
- Добавлена и улучшена обработка ошибок с использованием `try-catch` блоков в асинхронных функциях `getEbayAppToken`, `searchActiveItems`, `searchCompletedItems` и `searchItemsByKeyword` в `src/ebayApi.ts` для повышения стабильности. В случае ошибок сетевых запросов функции поиска теперь возвращают пустые массивы.

## [2024-07-30] - Аудит обработки ошибок в src/ebay.ts
### Изменено
- Проведен аудит обработки ошибок в `src/ebay.ts`. Существующая реализация с `try-catch` в функции `findItem` признана адекватной для текущих требований, так как она логирует ошибки и пробрасывает их для дальнейшей обработки на более высоком уровне.

## [2024-07-30] - Аудит и улучшение обработки ошибок в src/bot.ts
### Изменено
- Проведен аудит обработки ошибок в `src/bot.ts`. Добавлены `try-catch` блоки с использованием `handleApiError` в `case` операторы `check_balance`, `topup`, `redeem_prompt` и `generate_coupon_prompt` внутри `bot.on('callback_query')` для повышения стабильности.
